from fastapi import FastAPI # importamos el API
from pydantic import BaseModel
from typing import List
import pickle # importamos la librer√≠a para cargar el modelo
import xgboost # ibid
import numpy as np

class ApiInput(BaseModel):
    Novedad_M: List[float]
    Novedad_N: List[float]
    Marca_ACURA: List[float]
    Marca_AG: List[float]
    Marca_AGRALE: List[float]
    Marca_AKT: List[float]
    Marca_ALEKO: List[float]
    Marca_ALFA_ROMEO: List[float]
    Marca_AMC: List[float]
    Marca_AMPLE: List[float]
    Marca_APRILIA: List[float]
    Marca_ARCTIC_CAT: List[float]
    Marca_AROCARPATI: List[float]
    Marca_ASIA: List[float]
    Marca_ATM: List[float]
    Marca_AUDI: List[float]
    Marca_AUPACO: List[float]
    Marca_AUTECO: List[float]
    Marca_AYCO: List[float]
    Marca_BAIC: List[float]
    Marca_BAW: List[float]
    Marca_BENELLI: List[float]
    Marca_BMW: List[float]
    Marca_BORGO: List[float]
    Marca_BRILLIANCE: List[float]
    Marca_BRP_CAN_AM: List[float]
    Marca_BUICK: List[float]
    Marca_BYD: List[float]
    Marca_CADILLAC: List[float]
    Marca_CAGIVA: List[float]
    Marca_CHANA: List[float]
    Marca_CHANGAN: List[float]
    Marca_CHANGFENG: List[float]
    Marca_CHANGHE: List[float]
    Marca_CHERY: List[float]
    Marca_CHEVROLET: List[float]
    Marca_CHRYSLER: List[float]
    Marca_CITROEN: List[float]
    Marca_CMC: List[float]
    Marca_DACIA: List[float]
    Marca_DADI: List[float]
    Marca_DAEWOO: List[float]
    Marca_DAF: List[float]
    Marca_DAIHATSU: List[float]
    Marca_DAYANG: List[float]
    Marca_DERBI: List[float]
    Marca_DFAC: List[float]
    Marca_DFSK_DFM_DFZL: List[float]
    Marca_DINA: List[float]
    Marca_DODGE: List[float]
    Marca_DONGBEN: List[float]
    Marca_DS: List[float]
    Marca_DUCATI: List[float]
    Marca_EAGLE_CARGO: List[float]
    Marca_EUROPAMOTOS: List[float]
    Marca_EUROSTAR_D_LONG: List[float]
    Marca_FAW_AMI: List[float]
    Marca_FERRARI: List[float]
    Marca_FIAT: List[float]
    Marca_FIRENZE: List[float]
    Marca_FORD: List[float]
    Marca_FOTON: List[float]
    Marca_FREIGHTLINER: List[float]
    Marca_FUSO: List[float]
    Marca_GEELY: List[float]
    Marca_GLOW: List[float]
    Marca_GMC: List[float]
    Marca_GOLDEN_DRAGON: List[float]
    Marca_GOMOTOR: List[float]
    Marca_GONOW: List[float]
    Marca_GREAT_WALL_MOTOR: List[float]
    Marca_GUZI: List[float]
    Marca_HAFEI: List[float]
    Marca_HAIMA: List[float]
    Marca_HAOJIANG: List[float]
    Marca_HAOJUE: List[float]
    Marca_HARLEY_DAVIDSON: List[float]
    Marca_HERO: List[float]
    Marca_HIGER: List[float]
    Marca_HINO: List[float]
    Marca_HONDA: List[float]
    Marca_HONLEI: List[float]
    Marca_HUALIN: List[float]
    Marca_HUANGHAI: List[float]
    Marca_HUMMER: List[float]
    Marca_HUSQVARNA: List[float]
    Marca_HYOSUNG: List[float]
    Marca_HYUNDAI: List[float]
    Marca_INFINITI: List[float]
    Marca_INTERNATIONAL: List[float]
    Marca_ISUZU: List[float]
    Marca_IVECO: List[float]
    Marca_JAC: List[float]
    Marca_JAGUAR: List[float]
    Marca_JAWA: List[float]
    Marca_JEEP: List[float]
    Marca_JIALING: List[float]
    Marca_JINBEI: List[float]
    Marca_JINCHENG: List[float]
    Marca_JINFENG: List[float]
    Marca_JMC: List[float]
    Marca_JOYLONG: List[float]
    Marca_KAMAZ: List[float]
    Marca_KAWASAKI: List[float]
    Marca_KAYAK: List[float]
    Marca_KAZUKI: List[float]
    Marca_KEEWAY: List[float]
    Marca_KENWORTH: List[float]
    Marca_KIA: List[float]
    Marca_KTM: List[float]
    Marca_KYMCO: List[float]
    Marca_KYOTO: List[float]
    Marca_LADA: List[float]
    Marca_LANCIA: List[float]
    Marca_LAND_ROVER: List[float]
    Marca_LANDWIND: List[float]
    Marca_LEXUS: List[float]
    Marca_LIFAN: List[float]
    Marca_LINCOLN: List[float]
    Marca_LML: List[float]
    Marca_LMX: List[float]
    Marca_MACK: List[float]
    Marca_MAHINDRA: List[float]
    Marca_MASERATI: List[float]
    Marca_MAXMOTOR: List[float]
    Marca_MAXUS: List[float]
    Marca_MAZDA: List[float]
    Marca_MD_BIKES: List[float]
    Marca_MERCEDES_BENZ: List[float]
    Marca_MERCURY: List[float]
    Marca_MG: List[float]
    Marca_MINI: List[float]
    Marca_MITSUBISHI: List[float]
    Marca_MORINI: List[float]
    Marca_MOTO_ABC: List[float]
    Marca_MOTO_GUZZI: List[float]
    Marca_MTK: List[float]
    Marca_MUDAN: List[float]
    Marca_MV_AGUSTA: List[float]
    Marca_NISSAN: List[float]
    Marca_NITRO: List[float]
    Marca_NON_PLUS_ULTRA: List[float]
    Marca_OLTCIT: List[float]
    Marca_OPEL: List[float]
    Marca_PASSAGGIO: List[float]
    Marca_PEGASO: List[float]
    Marca_PEUGEOT: List[float]
    Marca_PIAGGIO: List[float]
    Marca_POLARIS: List[float]
    Marca_PONTIAC: List[float]
    Marca_PORSCHE: List[float]
    Marca_QINGQI: List[float]
    Marca_RENAULT: List[float]
    Marca_ROVER: List[float]
    Marca_ROYAL_ENFIELD: List[float]
    Marca_SAAB: List[float]
    Marca_SACHS: List[float]
    Marca_SAICWULING: List[float]
    Marca_SANYA: List[float]
    Marca_SATURN: List[float]
    Marca_SCANIA: List[float]
    Marca_SCION: List[float]
    Marca_SCOMADI: List[float]
    Marca_SEAT: List[float]
    Marca_SHINERAY: List[float]
    Marca_SHUANGHUAN: List[float]
    Marca_SIGMA: List[float]
    Marca_SINOTRUK: List[float]
    Marca_SKODA: List[float]
    Marca_SKYGO: List[float]
    Marca_SMART: List[float]
    Marca_SMC: List[float]
    Marca_SOYAT: List[float]
    Marca_SSANGYONG: List[float]
    Marca_STEYR: List[float]
    Marca_SUBARU: List[float]
    Marca_SUKIDA: List[float]
    Marca_SUKYAMA: List[float]
    Marca_SUZUKI: List[float]
    Marca_SYM: List[float]
    Marca_T_KING: List[float]
    Marca_TATA: List[float]
    Marca_TEMPEST: List[float]
    Marca_TIANMA: List[float]
    Marca_TITANIA: List[float]
    Marca_TMD: List[float]
    Marca_TONGKO: List[float]
    Marca_TOYOTA: List[float]
    Marca_TRIUMPH: List[float]
    Marca_TVS: List[float]
    Marca_TX_MOTORS: List[float]
    Marca_UFO: List[float]
    Marca_UKM: List[float]
    Marca_UNITED_MOTORS: List[float]
    Marca_USW_MOTORS: List[float]
    Marca_VERUCCI: List[float]
    Marca_VESPA: List[float]
    Marca_VICTORY: List[float]
    Marca_VOLKSWAGEN: List[float]
    Marca_VOLVO: List[float]
    Marca_WANXIN: List[float]
    Marca_WCR: List[float]
    Marca_XIANFENG: List[float]
    Marca_XINGYUE: List[float]
    Marca_XINKAI: List[float]
    Marca_YAKEY: List[float]
    Marca_YAKIMA: List[float]
    Marca_YAMAHA: List[float]
    Marca_YAXING: List[float]
    Marca_YINGANG: List[float]
    Marca_YUEJIN_NAVECO: List[float]
    Marca_YUGO: List[float]
    Marca_YUTONG: List[float]
    Marca_ZAHAV: List[float]
    Marca_ZHONGNENG: List[float]
    Marca_ZHONGXING: List[float]
    Marca_ZNA: List[float]
    Marca_ZONGSHEN: List[float]
    Marca_ZOTYE: List[float]
    Marca_ZQ_MOTORS: List[float]
    Clase_BUS_BUSETA_MICROBUS: List[float]
    Clase_CAMION: List[float]
    Clase_CAMIONETA_PASAJ: List[float]
    Clase_CAMIONETA_REPAR: List[float]
    Clase_CAMPERO: List[float]
    Clase_CARROTANQUE: List[float]
    Clase_CHASIS: List[float]
    Clase_FURGON: List[float]
    Clase_MOTOCARRO: List[float]
    Clase_MOTOCICLETA: List[float]
    Clase_PICKUP_DOBLE_CAB: List[float]
    Clase_PICKUP_SENCILLA: List[float]
    Clase_REMOLCADOR: List[float]
    Clase_VOLQUETA: List[float]
    TipoCaja_MT: List[float]
    TipoCaja_TP: List[float]
    Nacionalidad_ARG: List[float]
    Nacionalidad_AUS: List[float]
    Nacionalidad_BRA: List[float]
    Nacionalidad_CAN: List[float]
    Nacionalidad_CHI: List[float]
    Nacionalidad_CHL: List[float]
    Nacionalidad_COL: List[float]
    Nacionalidad_CZE: List[float]
    Nacionalidad_ECU: List[float]
    Nacionalidad_ENG: List[float]
    Nacionalidad_ESP: List[float]
    Nacionalidad_FRA: List[float]
    Nacionalidad_HNG: List[float]
    Nacionalidad_IDN: List[float]
    Nacionalidad_IND: List[float]
    Nacionalidad_ITA: List[float]
    Nacionalidad_JAP: List[float]
    Nacionalidad_KOR: List[float]
    Nacionalidad_MEX: List[float]
    Nacionalidad_NED: List[float]
    Nacionalidad_RUM: List[float]
    Nacionalidad_RUS: List[float]
    Nacionalidad_SUE: List[float]
    Nacionalidad_TAI: List[float]
    Nacionalidad_TWN: List[float]
    Nacionalidad_USA: List[float]
    Nacionalidad_VEN: List[float]
    Combustible_GAS: List[float]
    Combustible_GSL: List[float]
    Combustible_HBD: List[float]
    Transmision_3X1: List[float]
    Transmision_3X2: List[float]
    Transmision_4X2: List[float]
    Transmision_4X4: List[float]
    Transmision_4x2: List[float]
    Transmision_6X2: List[float]
    Transmision_6X4: List[float]
    Transmision_6x4: List[float]
    Transmision_8X4: List[float]
    IdServicio: List[float]
    Importado: List[float]
    AireAcondicionado: List[float]
    CapacidadPasajeros: List[float]
    Puertas: List[float]
    Ejes: List[float]
    Peso: List[float]
    Potencia: List[float]
    Cilindraje: List[float]
    CapacidadCarga: List[float]


class ApiOutput(BaseModel):
    Precio2018: float

app = FastAPI() # creamos el api
file_name = "xgb_regressor.pkl"
model = pickle.load(open(file_name, "rb"))

@app.post("/predict")
def predict(input_data: ApiInput):
    # Convertir los datos de entrada a un array de NumPy
    input_array = np.array([input_data.Novedad_M, input_data.Novedad_N, input_data.Marca_ACURA, input_data.Marca_AG, input_data.Marca_AGRALE, input_data.Marca_AKT, input_data.Marca_ALEKO, input_data.Marca_ALFA_ROMEO, input_data.Marca_AMC, input_data.Marca_AMPLE, input_data.Marca_APRILIA, input_data.Marca_ARCTIC_CAT, input_data.Marca_AROCARPATI, input_data.Marca_ASIA, input_data.Marca_ATM, input_data.Marca_AUDI, input_data.Marca_AUPACO, input_data.Marca_AUTECO, input_data.Marca_AYCO, input_data.Marca_BAIC, input_data.Marca_BAW, input_data.Marca_BENELLI, input_data.Marca_BMW, input_data.Marca_BORGO, input_data.Marca_BRILLIANCE, input_data.Marca_BRP_CAN_AM, input_data.Marca_BUICK, input_data.Marca_BYD, input_data.Marca_CADILLAC, input_data.Marca_CAGIVA, input_data.Marca_CHANA, input_data.Marca_CHANGAN, input_data.Marca_CHANGFENG, input_data.Marca_CHANGHE, input_data.Marca_CHERY, input_data.Marca_CHEVROLET, input_data.Marca_CHRYSLER, input_data.Marca_CITROEN, input_data.Marca_CMC, input_data.Marca_DACIA, input_data.Marca_DADI, input_data.Marca_DAEWOO, input_data.Marca_DAF, input_data.Marca_DAIHATSU, input_data.Marca_DAYANG, input_data.Marca_DERBI, input_data.Marca_DFAC, input_data.Marca_DFSK_DFM_DFZL, input_data.Marca_DINA, input_data.Marca_DODGE, input_data.Marca_DONGBEN, input_data.Marca_DS, input_data.Marca_DUCATI, input_data.Marca_EAGLE_CARGO, input_data.Marca_EUROPAMOTOS, input_data.Marca_EUROSTAR_D_LONG, input_data.Marca_FAW_AMI, input_data.Marca_FERRARI, input_data.Marca_FIAT, input_data.Marca_FIRENZE, input_data.Marca_FORD, input_data.Marca_FOTON, input_data.Marca_FREIGHTLINER, input_data.Marca_FUSO, input_data.Marca_GEELY, input_data.Marca_GLOW, input_data.Marca_GMC, input_data.Marca_GOLDEN_DRAGON, input_data.Marca_GOMOTOR, input_data.Marca_GONOW, input_data.Marca_GREAT_WALL_MOTOR, input_data.Marca_GUZI, input_data.Marca_HAFEI, input_data.Marca_HAIMA, input_data.Marca_HAOJIANG, input_data.Marca_HAOJUE, input_data.Marca_HARLEY_DAVIDSON, input_data.Marca_HERO, input_data.Marca_HIGER, input_data.Marca_HINO, input_data.Marca_HONDA, input_data.Marca_HONLEI, input_data.Marca_HUALIN, input_data.Marca_HUANGHAI, input_data.Marca_HUMMER, input_data.Marca_HUSQVARNA, input_data.Marca_HYOSUNG, input_data.Marca_HYUNDAI, input_data.Marca_INFINITI, input_data.Marca_INTERNATIONAL, input_data.Marca_ISUZU, input_data.Marca_IVECO, input_data.Marca_JAC, input_data.Marca_JAGUAR, input_data.Marca_JAWA, input_data.Marca_JEEP, input_data.Marca_JIALING, input_data.Marca_JINBEI, input_data.Marca_JINCHENG, input_data.Marca_JINFENG, input_data.Marca_JMC, input_data.Marca_JOYLONG, input_data.Marca_KAMAZ, input_data.Marca_KAWASAKI, input_data.Marca_KAYAK, input_data.Marca_KAZUKI, input_data.Marca_KEEWAY, input_data.Marca_KENWORTH, input_data.Marca_KIA, input_data.Marca_KTM, input_data.Marca_KYMCO, input_data.Marca_KYOTO, input_data.Marca_LADA, input_data.Marca_LANCIA, input_data.Marca_LAND_ROVER, input_data.Marca_LANDWIND, input_data.Marca_LEXUS, input_data.Marca_LIFAN, input_data.Marca_LINCOLN, input_data.Marca_LML, input_data.Marca_LMX, input_data.Marca_MACK, input_data.Marca_MAHINDRA, input_data.Marca_MASERATI, input_data.Marca_MAXMOTOR, input_data.Marca_MAXUS, input_data.Marca_MAZDA, input_data.Marca_MD_BIKES, input_data.Marca_MERCEDES_BENZ, input_data.Marca_MERCURY, input_data.Marca_MG, input_data.Marca_MINI, input_data.Marca_MITSUBISHI, input_data.Marca_MORINI, input_data.Marca_MOTO_ABC, input_data.Marca_MOTO_GUZZI, input_data.Marca_MTK, input_data.Marca_MUDAN, input_data.Marca_MV_AGUSTA, input_data.Marca_NISSAN, input_data.Marca_NITRO, input_data.Marca_NON_PLUS_ULTRA, input_data.Marca_OLTCIT, input_data.Marca_OPEL, input_data.Marca_PASSAGGIO, input_data.Marca_PEGASO, input_data.Marca_PEUGEOT, input_data.Marca_PIAGGIO, input_data.Marca_POLARIS, input_data.Marca_PONTIAC, input_data.Marca_PORSCHE, input_data.Marca_QINGQI, input_data.Marca_RENAULT, input_data.Marca_ROVER, input_data.Marca_ROYAL_ENFIELD, input_data.Marca_SAAB, input_data.Marca_SACHS, input_data.Marca_SAICWULING, input_data.Marca_SANYA, input_data.Marca_SATURN, input_data.Marca_SCANIA, input_data.Marca_SCION, input_data.Marca_SCOMADI, input_data.Marca_SEAT, input_data.Marca_SHINERAY, input_data.Marca_SHUANGHUAN, input_data.Marca_SIGMA, input_data.Marca_SINOTRUK, input_data.Marca_SKODA, input_data.Marca_SKYGO, input_data.Marca_SMART, input_data.Marca_SMC, input_data.Marca_SOYAT, input_data.Marca_SSANGYONG, input_data.Marca_STEYR, input_data.Marca_SUBARU, input_data.Marca_SUKIDA, input_data.Marca_SUKYAMA, input_data.Marca_SUZUKI, input_data.Marca_SYM, input_data.Marca_T_KING, input_data.Marca_TATA, input_data.Marca_TEMPEST, input_data.Marca_TIANMA, input_data.Marca_TITANIA, input_data.Marca_TMD, input_data.Marca_TONGKO, input_data.Marca_TOYOTA, input_data.Marca_TRIUMPH, input_data.Marca_TVS, input_data.Marca_TX_MOTORS, input_data.Marca_UFO, input_data.Marca_UKM, input_data.Marca_UNITED_MOTORS, input_data.Marca_USW_MOTORS, input_data.Marca_VERUCCI, input_data.Marca_VESPA, input_data.Marca_VICTORY, input_data.Marca_VOLKSWAGEN, input_data.Marca_VOLVO, input_data.Marca_WANXIN, input_data.Marca_WCR, input_data.Marca_XIANFENG, input_data.Marca_XINGYUE, input_data.Marca_XINKAI, input_data.Marca_YAKEY, input_data.Marca_YAKIMA, input_data.Marca_YAMAHA, input_data.Marca_YAXING, input_data.Marca_YINGANG, input_data.Marca_YUEJIN_NAVECO, input_data.Marca_YUGO, input_data.Marca_YUTONG, input_data.Marca_ZAHAV, input_data.Marca_ZHONGNENG, input_data.Marca_ZHONGXING, input_data.Marca_ZNA, input_data.Marca_ZONGSHEN, input_data.Marca_ZOTYE, input_data.Marca_ZQ_MOTORS, input_data.Clase_BUS_BUSETA_MICROBUS, input_data.Clase_CAMION, input_data.Clase_CAMIONETA_PASAJ, input_data.Clase_CAMIONETA_REPAR, input_data.Clase_CAMPERO, input_data.Clase_CARROTANQUE, input_data.Clase_CHASIS, input_data.Clase_FURGON, input_data.Clase_MOTOCARRO, input_data.Clase_MOTOCICLETA, input_data.Clase_PICKUP_DOBLE_CAB, input_data.Clase_PICKUP_SENCILLA, input_data.Clase_REMOLCADOR, input_data.Clase_VOLQUETA, input_data.TipoCaja_MT, input_data.TipoCaja_TP, input_data.Nacionalidad_ARG, input_data.Nacionalidad_AUS, input_data.Nacionalidad_BRA, input_data.Nacionalidad_CAN, input_data.Nacionalidad_CHI, input_data.Nacionalidad_CHL, input_data.Nacionalidad_COL, input_data.Nacionalidad_CZE, input_data.Nacionalidad_ECU, input_data.Nacionalidad_ENG, input_data.Nacionalidad_ESP, input_data.Nacionalidad_FRA, input_data.Nacionalidad_HNG, input_data.Nacionalidad_IDN, input_data.Nacionalidad_IND, input_data.Nacionalidad_ITA, input_data.Nacionalidad_JAP, input_data.Nacionalidad_KOR, input_data.Nacionalidad_MEX, input_data.Nacionalidad_NED, input_data.Nacionalidad_RUM, input_data.Nacionalidad_RUS, input_data.Nacionalidad_SUE, input_data.Nacionalidad_TAI, input_data.Nacionalidad_TWN, input_data.Nacionalidad_USA, input_data.Nacionalidad_VEN, input_data.Combustible_GAS, input_data.Combustible_GSL, input_data.Combustible_HBD, input_data.Transmision_3X1, input_data.Transmision_3X2, input_data.Transmision_4X2, input_data.Transmision_4X4, input_data.Transmision_4x2, input_data.Transmision_6X2, input_data.Transmision_6X4, input_data.Transmision_6x4, input_data.Transmision_8X4, input_data.IdServicio, input_data.Importado, input_data.AireAcondicionado, input_data.CapacidadPasajeros, input_data.Puertas, input_data.Ejes, input_data.Peso, input_data.Potencia, input_data.Cilindraje, input_data.CapacidadCarga]).reshape(1, -1)

    # Obtener la predicci√≥n del modelo
    prediction = model.predict(input_array)

    # Crear la respuesta del API
    output_data = ApiOutput(Precio2018=prediction[0])

    return output_data
